# [FR-008] Output Buffer / Preview Panel

## Labels
`MUS`, `feature`, `ui`, `clipboard`

## User Story
As a user, I want to see a preview of my transcription before it's pasted, so that I can verify the output or wait for the right moment to paste it.

## Proposed Solution

### Overview
Implement a preview panel that appears after transcription completes. The panel shows the transcribed text and provides options to edit, copy, or paste. This prevents accidental pasting in the wrong location.

### Implementation Flow
1. Transcription completes
2. Preview panel slides in (from top or bottom)
3. User can:
   - Review the text
   - Edit if needed
   - Click "Paste" to paste at cursor
   - Click "Copy" to copy to clipboard only
   - Click "Dismiss" to close without pasting
4. Panel auto-dismisses after 30 seconds if no action

### Technical Approach

**Preview Panel Component:**
```tsx
// src/components/PreviewPanel.tsx
interface PreviewPanelProps {
  transcript: string;
  mode: 'raw' | 'modified';
  onPaste: () => void;
  onCopy: () => void;
  onDismiss: () => void;
  onEdit: (text: string) => void;
}

export function PreviewPanel({
  transcript,
  mode,
  onPaste,
  onCopy,
  onDismiss,
  onEdit,
}: PreviewPanelProps) {
  const [editedText, setEditedText] = useState(transcript);
  const [isEditing, setIsEditing] = useState(false);
  
  return (
    <motion.div
      initial={{ y: -100, opacity: 0 }}
      animate={{ y: 0, opacity: 1 }}
      exit={{ y: -100, opacity: 0 }}
      className="fixed top-4 left-1/2 -translate-x-1/2 z-50"
    >
      <div className="bg-glass border border-glass-border rounded-2xl shadow-2xl p-4 min-w-[500px] max-w-[800px]">
        <div className="flex items-center justify-between mb-3">
          <div className="flex items-center gap-2">
            <span className="text-xs font-medium text-accent uppercase">
              {mode} Mode
            </span>
            <span className="text-xs text-foreground-muted">
              Preview before paste
            </span>
          </div>
          <button onClick={onDismiss} className="text-foreground-muted hover:text-foreground">
            <X size={16} />
          </button>
        </div>
        
        {isEditing ? (
          <textarea
            value={editedText}
            onChange={(e) => setEditedText(e.target.value)}
            className="w-full h-32 bg-surface rounded-lg p-3 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-accent"
          />
        ) : (
          <div 
            onClick={() => setIsEditing(true)}
            className="w-full h-32 bg-surface rounded-lg p-3 text-sm overflow-y-auto cursor-text hover:bg-surface-elevated transition-colors"
          >
            {editedText}
          </div>
        )}
        
        <div className="flex items-center justify-end gap-2 mt-3">
          <Button variant="ghost" size="sm" onClick={onCopy}>
            <Copy size={14} className="mr-1" />
            Copy
          </Button>
          <Button variant="secondary" size="sm" onClick={() => setIsEditing(!isEditing)}>
            {isEditing ? 'Done' : 'Edit'}
          </Button>
          <Button size="sm" onClick={() => onPaste()}>
            <Check size={14} className="mr-1" />
            Paste
          </Button>
        </div>
      </div>
    </motion.div>
  );
}
```

### Key Considerations
- Panel should not steal focus from current application
- Auto-dismiss timer (30s) with visual countdown
- Edited text should be what's pasted/copied
- Position: Centered at top of screen (like Raycast)

## Acceptance Criteria

- [ ] Preview panel appears after transcription completes
- [ ] Panel shows transcribed text clearly
- [ ] User can edit text before pasting
- [ ] "Paste" button pastes at cursor location
- [ ] "Copy" button copies to clipboard without pasting
- [ ] "Dismiss" closes panel without any action
- [ ] Panel auto-dismisses after 30 seconds
- [ ] Panel doesn't steal focus from active application
