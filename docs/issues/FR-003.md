# [FR-003] Groq Transcription Integration

## Labels
`MUS`, `core`, `api`, `groq`

## User Story
As a user, I want my recorded audio to be transcribed using Groq's Whisper API, so that I get fast and accurate text output from my voice.

## Proposed Solution

### Overview
Integrate with Groq's API to transcribe audio files using the whisper-large-v3-turbo model. The transcription should happen asynchronously with progress indication, and the result should be stored for further processing.

### Implementation Flow
1. Recording completes and audio file is saved
2. Frontend sends audio file to Rust backend
3. Backend uploads audio to Groq API
4. Poll/wait for transcription result
5. Store result in database
6. Return transcript to frontend

### Technical Approach

**Rust Backend:**
```rust
// src-tauri/src/services/groq.rs
use reqwest::multipart::{Form, Part};
use serde::Deserialize;

#[derive(Deserialize)]
struct TranscriptionResponse {
    text: String,
}

pub async fn transcribe_audio(
    api_key: &str,
    audio_path: &str,
) -> Result<String, String> {
    let client = reqwest::Client::new();
    let audio_bytes = tokio::fs::read(audio_path).await
        .map_err(|e| e.to_string())?;
    
    let part = Part::bytes(audio_bytes)
        .file_name("recording.wav")
        .mime_str("audio/wav")
        .map_err(|e| e.to_string())?;
    
    let form = Form::new()
        .part("file", part)
        .text("model", "whisper-large-v3-turbo");
    
    let response = client
        .post("https://api.groq.com/openai/v1/audio/transcriptions")
        .bearer_auth(api_key)
        .multipart(form)
        .send()
        .await
        .map_err(|e| e.to_string())?;
    
    let result: TranscriptionResponse = response
        .json()
        .await
        .map_err(|e| e.to_string())?;
    
    Ok(result.text)
}
```

**Frontend:**
```typescript
// src/services/transcription.ts
import { invoke } from '@tauri-apps/api/core';

export async function transcribeRecording(
  recordingId: string
): Promise<string> {
  return invoke('transcribe_recording', { recordingId });
}
```

### Key Considerations
- API key must be stored securely (OS keychain)
- Handle network errors with retry logic
- Timeout after 30 seconds
- Support both whisper-large-v3 and whisper-large-v3-turbo models
- Store raw transcript in database before refinement

## Acceptance Criteria

- [ ] Audio file uploaded to Groq API successfully
- [ ] Transcription result returned within 10 seconds for 30s audio
- [ ] Raw transcript stored in database
- [ ] Network errors handled with user-friendly message
- [ ] API key stored securely in OS keychain
- [ ] Progress indicator shown during transcription
- [ ] Support model selection (turbo vs standard)
- [ ] Transcription accuracy > 95% for clear speech
