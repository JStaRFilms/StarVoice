# [FR-002] Audio Recording with Visual Feedback

## Labels
`MUS`, `core`, `audio`, `ui`

## User Story
As a user, I want to see visual feedback while recording audio, so that I know the app is actively capturing my voice and can monitor recording levels.

## Proposed Solution

### Overview
Implement audio recording using Web Audio API with a beautiful visual waveform that responds to voice input. The recording interface should be a full-screen overlay with a central animated waveform.

### Implementation Flow
1. User triggers recording via shortcut
2. Request microphone permission (if not granted)
3. Initialize MediaRecorder with audio constraints
4. Start recording to temporary file
5. Display real-time waveform visualization
6. Show recording timer
7. On stop, finalize audio file and return path

### Technical Approach

**Audio Recording Service:**
```typescript
// src/services/audioRecorder.ts
export class AudioRecorder {
  private mediaRecorder: MediaRecorder | null = null;
  private audioChunks: Blob[] = [];
  private stream: MediaStream | null = null;

  async startRecording(): Promise<void> {
    this.stream = await navigator.mediaDevices.getUserMedia({
      audio: {
        echoCancellation: true,
        noiseSuppression: true,
        sampleRate: 44100,
      }
    });
    
    this.mediaRecorder = new MediaRecorder(this.stream);
    this.audioChunks = [];
    
    this.mediaRecorder.ondataavailable = (e) => {
      this.audioChunks.push(e.data);
    };
    
    this.mediaRecorder.start(100); // Collect data every 100ms
  }

  async stopRecording(): Promise<Blob> {
    return new Promise((resolve) => {
      this.mediaRecorder!.onstop = () => {
        const blob = new Blob(this.audioChunks, { type: 'audio/wav' });
        this.stream?.getTracks().forEach(t => t.stop());
        resolve(blob);
      };
      this.mediaRecorder!.stop();
    });
  }
}
```

**Waveform Visualization:**
```tsx
// src/components/WaveformVisualizer.tsx
export function WaveformVisualizer({ isRecording }: { isRecording: boolean }) {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const analyserRef = useRef<AnalyserNode | null>(null);
  
  useEffect(() => {
    if (!isRecording || !canvasRef.current) return;
    
    const ctx = canvasRef.current.getContext('2d')!;
    const analyser = analyserRef.current!;
    const dataArray = new Uint8Array(analyser.frequencyBinCount);
    
    const draw = () => {
      analyser.getByteFrequencyData(dataArray);
      // Draw waveform bars...
      requestAnimationFrame(draw);
    };
    
    draw();
  }, [isRecording]);
  
  return (
    <canvas 
      ref={canvasRef} 
      className="w-full h-32 rounded-lg"
    />
  );
}
```

### Key Considerations
- Handle microphone permission denial gracefully
- Maximum recording duration: 5 minutes (configurable)
- Save audio as WAV format for compatibility
- Show recording timer (mm:ss format)
- Visual indicator when audio levels are too low

## Acceptance Criteria

- [ ] Recording overlay appears with animated waveform
- [ ] Waveform responds to voice input in real-time
- [ ] Recording timer displays elapsed time
- [ ] Audio saved as WAV file to temp directory
- [ ] Permission denied shows helpful error message
- [ ] Recording stops automatically after 5 minutes
- [ ] Cancel button (or Escape) stops without saving
- [ ] Waveform animation runs at 60fps
