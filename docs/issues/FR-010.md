# [FR-010] Settings Management

## Labels
`MUS`, `feature`, `settings`, `ui`

## User Story
As a user, I want to configure the app settings, so that I can customize shortcuts, API keys, and default behaviors to my preferences.

## Proposed Solution

### Overview
Implement a settings window/panel where users can configure:
- Global shortcut key
- Default transcription mode (Raw/Modified)
- Groq API key
- Auto-paste behavior
- Preview panel preferences

### Implementation Flow
1. User opens settings from tray menu or shortcut
2. Settings window opens with tabbed interface
3. User modifies settings
4. Changes saved to database
5. Active settings updated in real-time

### Technical Approach

**Settings Schema:**
```sql
CREATE TABLE settings (
    key VARCHAR(50) PRIMARY KEY,
    value TEXT NOT NULL,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Default settings
INSERT INTO settings (key, value) VALUES
    ('global_shortcut', 'Ctrl+Shift+R'),
    ('default_mode', 'raw'),
    ('auto_paste', 'true'),
    ('show_preview', 'true'),
    ('preview_timeout', '30'),
    ('audio_retention_hours', '24'),
    ('max_recording_duration', '300'),
    ('groq_model', 'whisper-large-v3-turbo');
```

**Settings Service:**
```rust
// src-tauri/src/settings.rs
pub struct Settings {
    db: Database,
}

impl Settings {
    pub async fn get(&self, key: &str) -> Result<String, String> {
        self.db.get_setting(key).await
            .map_err(|e| e.to_string())
    }
    
    pub async fn set(&self, key: &str, value: &str) -> Result<(), String> {
        self.db.set_setting(key, value).await
            .map_err(|e| e.to_string())?;
        
        // Emit event for real-time updates
        self.app.emit("settings-changed", json!({
            "key": key,
            "value": value
        }));
        
        Ok(())
    }
    
    pub async fn get_shortcut(&self) -> Result<String, String> {
        self.get("global_shortcut").await
    }
    
    pub async fn get_default_mode(&self) -> Result<String, String> {
        self.get("default_mode").await
    }
}
```

**Settings UI:**
```tsx
// src/components/SettingsPanel.tsx
export function SettingsPanel() {
  const [settings, setSettings] = useState<Settings>({});
  const [activeTab, setActiveTab] = useState('general');
  
  const tabs = [
    { id: 'general', label: 'General', icon: Settings },
    { id: 'shortcuts', label: 'Shortcuts', icon: Keyboard },
    { id: 'api', label: 'API Keys', icon: Key },
    { id: 'advanced', label: 'Advanced', icon: Sliders },
  ];
  
  return (
    <div className="flex h-full">
      {/* Sidebar */}
      <div className="w-48 border-r border-glass-border p-2">
        {tabs.map((tab) => (
          <button
            key={tab.id}
            onClick={() => setActiveTab(tab.id)}
            className={cn(
              "w-full flex items-center gap-2 px-3 py-2 rounded-lg text-sm",
              activeTab === tab.id
                ? "bg-accent/10 text-accent"
                : "text-foreground-muted hover:text-foreground"
            )}
          >
            <tab.icon size={16} />
            {tab.label}
          </button>
        ))}
      </div>
      
      {/* Content */}
      <div className="flex-1 p-6">
        {activeTab === 'general' && <GeneralSettings />}
        {activeTab === 'shortcuts' && <ShortcutSettings />}
        {activeTab === 'api' && <ApiSettings />}
        {activeTab === 'advanced' && <AdvancedSettings />}
      </div>
    </div>
  );
}
```

### Key Considerations
- API keys stored securely (OS keychain integration)
- Shortcut validation (check for conflicts)
- Real-time settings updates
- Import/export settings option

## Acceptance Criteria

- [ ] Settings window accessible from tray menu
- [ ] Tabbed interface with General, Shortcuts, API, Advanced
- [ ] Global shortcut configurable
- [ ] Default mode (Raw/Modified) selectable
- [ ] API key input with masking
- [ ] Auto-paste toggle
- [ ] Preview timeout configurable
- [ ] Settings persist across app restarts
- [ ] Real-time updates when settings change
